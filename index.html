<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title data-i18n="app_title">مصاريفي | My Expenses</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png" />
  <link rel="icon" type="image/png" href="./assets/icons/icon-192.png" />

  <link rel="stylesheet" href="./styles.css" />

  <!-- Config & i18n -->
  <script src="./config.js"></script>
  <script src="./i18n.js" defer></script>

  <!-- Charts: loader يجلب Chart.js الحقيقي من CDN -->
  <script src="./vendor/chart-loader.js" defer></script>

  <!-- App modules -->
  <script type="module" src="./utils.js"></script>
  <script type="module" src="./storage.js"></script>
  <script type="module" src="./tips.js"></script>
  <script src="./charts.js" defer></script>
  <script type="module" src="./app.js"></script>
  <script src="./install.js" defer></script>

  <!-- Analytics & Ads (تقرأ من config.js) -->
  <script src="./analytics.js" defer></script>
  <script src="./ads.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="./assets/icons/icon-192.png" alt="" />
      <div class="brand-name" data-i18n="app_title">مصاريفي | My Expenses</div>
    </div>
    <div class="actions">
      <button id="langToggle" class="btn small">EN</button>
      <a href="./privacy.html" class="btn small" data-i18n="privacy">الخصوصية</a>
      <button id="installBtn" class="btn small" data-i18n="install_app" style="display:none">📲 ثبّت التطبيق</button>
      <button id="howInstallBtn" class="btn small">طريقة التثبيت</button>
    </div>
  </header>

  <!-- HERO Ad (مميز) -->
  <div id="ad-hero" class="ad-hero" aria-label="Hero Ad"></div>

  <!-- Top banner -->
  <div id="ad-top" class="ad-box" aria-label="Top banner"></div>

  <main class="container" id="mainApp">
    <!-- Summary: Today / Month -->
    <section class="grid summary" data-section="home">
      <div class="card">
        <div class="kpi">
          <div class="label" data-i18n="daily_title">مصاريف اليوم</div>
          <div class="value"><span data-i18n="spent">المصروف</span>:
            <strong id="spentToday">0</strong></div>
        </div>
      </div>
      <div class="card" id="budgetBox">
        <div class="kpi">
          <div class="label" data-i18n="monthly_title">الشهر الحالي</div>
          <div class="value">
            <span data-i18n="spent">المصروف</span>:
            <strong id="spentMonth">0</strong> •
            <span data-i18n="remaining">المتبقي</span>:
            <strong id="remainingMonth">--</strong>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="kpi">
          <div class="label" data-i18n="highest_category">أعلى تصنيف إنفاق</div>
          <div id="topCategory" class="value">-</div>
        </div>
      </div>
      <div class="card">
        <div class="kpi">
          <div class="label" data-i18n="total_today">إجمالي اليوم</div>
          <div id="totalToday" class="value">0</div>
        </div>
      </div>
      <div class="card">
        <div class="kpi">
          <div class="label" data-i18n="total_month">إجمالي الشهر</div>
          <div id="totalMonth" class="value">0</div>
        </div>
      </div>
    </section>

    <!-- Tips -->
    <section class="card" style="margin-top:12px">
      <h3 data-i18n="tips">نصائح ذكية</h3>
      <ul id="tipsList"></ul>
    </section>

    <!-- Settings & Filters -->
    <section class="controls" data-section="settings" style="margin-top:12px">
      <div class="card">
        <h3 data-i18n="set_budget">إعدادات</h3>
        <div class="row">
          <input id="monthlyBudget" type="number" placeholder="3000" data-i18n-ph="budget_placeholder" />
          <input id="currencySymbol" style="max-width:120px" placeholder="$" data-i18n="currency_symbol" />
          <select id="numberLocale" style="max-width:160px">
            <option value="en-US">en-US</option>
            <option value="ar-EG">ar-EG</option>
            <option value="fr-FR">fr-FR</option>
          </select>
          <button id="saveSettings" class="btn" data-i18n="save">حفظ</button>
        </div>
      </div>

      <div class="card">
        <h3 data-i18n="filters">بحث/تصفية</h3>
        <div class="row">
          <input id="filterCat" list="catList" data-i18n-ph="category_ph" placeholder="اكتب تصنيفًا (حر)" />
          <input id="filterFrom" type="date" data-i18n-ph="filter_date_from" />
          <input id="filterTo" type="date" data-i18n-ph="filter_date_to" />
          <button id="applyFilters" class="btn" data-i18n="apply_filters">تطبيق</button>
          <button id="resetFilters" class="btn" data-i18n="reset_filters">إعادة تعيين</button>
        </div>
      </div>
    </section>

    <!-- Modal -->
    <div id="addModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <span class="close" aria-label="Close">×</span>
        <h3 data-i18n="add_expense">إضافة مصروف</h3>
        <form id="form">
          <input type="hidden" id="id" />
          <div class="row">
            <input id="name" required data-i18n-ph="name" placeholder="الاسم/الوصف" />
            <input id="amount" type="number" step="0.01" required data-i18n-ph="amount" placeholder="المبلغ" />
            <input id="category" list="catList" required data-i18n-ph="category_ph" placeholder="اكتب تصنيفًا (حر)" />
            <datalist id="catList"></datalist>
            <input id="date" type="date" required data-i18n-ph="date" />
            <input id="note" data-i18n-ph="note_optional" placeholder="ملاحظة (اختياري)" />
            <button class="btn" data-i18n="save">حفظ</button>
          </div>
        </form>
      </div>
    </div>

    <!-- List -->
    <section class="list card" data-section="home" style="margin-top:12px">
      <h3 data-i18n="expenses">المصاريف</h3>
      <div class="table">
        <table>
          <thead>
            <tr>
              <th data-i18n="name">الاسم/الوصف</th>
              <th data-i18n="category_free">التصنيف</th>
              <th data-i18n="date">التاريخ</th>
              <th data-i18n="amount">المبلغ</th>
              <th data-i18n="actions">إجراءات</th>
            </tr>
          </thead>
          <tbody id="expensesBody"></tbody>
        </table>
      </div>
      <div class="row">
        <button id="resetData" class="btn danger" data-i18n="reset_data">مسح البيانات</button>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts card" data-section="charts" style="margin-top:12px">
      <h3 data-i18n="charts">الرسوم البيانية</h3>
      <div class="row">
        <canvas id="pieChart" height="200"></canvas>
        <canvas id="barChart" height="200"></canvas>
      </div>
    </section>
  </main>

  <!-- Sticky bottom banner -->
  <div id="ad-bottom" class="ad-sticky" aria-label="Bottom banner"></div>

  <!-- Tabs -->
  <nav class="tabbar">
    <button class="tab active" data-tab="home" aria-label="Home">🏠</button>
    <button class="tab" data-tab="charts" aria-label="Charts">📊</button>
    <button class="tab" data-tab="settings" aria-label="Settings">⚙️</button>
  </nav>

  <footer class="footer">
    <small>© 2025 — <span data-i18n="app_title">مصاريفي | My Expenses</span></small>
  </footer>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./service-worker.js'));
    }
  </script>
</body>
</html>
